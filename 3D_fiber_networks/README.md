# READ ME

*Repository for generating a STL file of random aperiodic fiber network ready to be exported to a slicing software specific to the 3D printer's manufacturer.*

*Notbohm Research Group, https://notbohm.ep.wisc.edu/*

*University of Wisconsin-Madison, 2021-2022*

This readme explains the Notbohm lab code to generate STL files from a three-dimensional numerical model of fiber network for additive manufacturing. 
This readme is written by Mainak Sarkar under the guidance of Jacob Notbohm.
The scripts are written by Mainak Sarkar unless otherwise specified.

See note below about need for downloading functions from the Mathworks file exchange.

**NOTE:** To generate a three-dimensional fiber network, please follow the repository *fiber_network_model*.

## Section 1: Modeling fibers 

This section converts each fiber in the network into a three-dimensional hollow beam of circular cross-section with all of its surfaces triangulated in Standard Tessellation Language (STL). At each node, the code adds a sphere of dimeter equal to the diameter of the fiber to remove the gap at the node. Then it creates a python script to run it on the Blender's scripting environment. In Blender, the individual fiber meshes are combined into a single object containing disconnected fiber meshes mutually overlapping near the nodes of the network. Following are the step-by-step instructions.

### Step 1 (in MATLAB):
#### Main file: 
`stl_gen_main_script_3D_Vup.m` 
#### Function files: 
`stl_gen_lattice_network_circleCS_3D_Vup.m`: Primary function file to convert fibers into beams of circular cross-section.

`blender_python_script_gen_3D_Vup.m`: Generates the python script to run in Blender.

**NOTE:** Additionally, the execution of scripts requires the following subfunction files,

(i) `cylinder2P.m`, which can be downloaded from the Mathworks file exchange repository: Per Sundqvist (2022). Cylinder Between 2 Points (https://www.mathworks.com/matlabcentral/fileexchange/5468-cylinder-between-2-points), MATLAB Central File Exchange. This subfunction creates the surface of the beam (with circular cross-section) and the beam is open-ended. 

(ii) `surf2stl.m`, which can be downloaded from the Mathworks file exchange repository: Bill McDonald (2022). surf2stl (https://www.mathworks.com/matlabcentral/fileexchange/4512-surf2stl), MATLAB Central File Exchange. This file encodes the beam surfaces generated by the subfunction `cylinder2P.m` into Standard Tessellation Language. 

#### Running the script:
Create a folder in a directory of your choice. This folder will be the primary folder to save the data generated in this process. 
Then go to the main script `stl_gen_main_script_3D_Vup.m`, and do the following, 

(a) input the value of radius of the fiber beams in line # 11;

(b) type in the destination path of the primary folder in line # 14;

(c) load the MAT file containing the information on nodes and fiber connectivity of the network in line # 17;

(d) name of the subfolder (within the primary folder) in line # 23 to contain the individual fiber meshes.

As an output, a python script `model_gen_script_blender_console.py` is automatically generated and saved in the primary folder.

### Step 2 (in Blender):
Blender is an open-source 3D graphics software and can be downloaded from https://www.blender.org/. Open the Blender's GUI and go to the tool bar at the top to select *scripting*. Then click on *open* tab at the top of the scripting console. Open the primary folder (that you used to store results in Step 1) and choose the python script `model_gen_script_blender_console.py` generated in Step 1. Open this script and hit the *play* button at the top of the console to run the python script. Once the script executes, you can close the GUI of Blender. 

During this process, as an output, a single object consisting of the disconnected fiber meshes is created and stored as STL file in the subfolder of STL files within the primary folder.

## Section 2: Boolean union of fiber meshes
Here the fiber meshes are geometrically connected.

Autodesk's Netfabb Premium 2023 is used in this section. Following steps are required.

Go to *File* > click on *Add Part* > (in dialog box showing details of errors) keep Automatic Repair unchecked as it should be and click on *Add Part* > right click on part/drawing > click on *prepare* > click on *Repair Part* > click on the tab *Run Repair Script* > choose *Extended Repair* > click on *Execute* 

Check the box of automatic update once the repair script executes successfully. You will find green ticks in the points 'mesh closed' and 'mesh oriented'.   

Finally, click on *Apply Repair* (choose *Remove Old Part* when prompted) > right click on part/drawing > click on *Export Part* > click on *as STL* (make sure that the binary STL files option is chosen) > you can name the file containing final STL file of the network > click on x*OK*  

Once done, close the Netfabb GUI.  

The STL file of the network as exported from Netfabb is ready to be imported into any commercial slicing software for additive manufacturing.

## Examples:
To run the scripts with the default parameters, the input MAT file for a representative random fiber network is provided under *Examples* in this repository: `3D_Network_for_STL_30x30x30_Seed_1003.mat`.

The output STL file for this representative network is also provoded: `final_merged_stl_file_for_AM.stl`. This file is ready to be sliced and printed in a 3D printer.




